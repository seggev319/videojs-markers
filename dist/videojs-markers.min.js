/*! videojs-markers - v0.9.0 - 2017-10-24
* Copyright (c) 2017 ; Licensed  */

!function(e,r){if("function"==typeof define&&define.amd)define(["video.js"],r);else if("undefined"!=typeof exports)r(require("video.js"));else{var t={exports:{}};r(e.videojs),e.videojsMarkers=t.exports}}(this,function(e){"use strict";function r(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==r?t:3&t|8).toString(16)})}var t=function(e){return e&&e.__esModule?e:{default:e}}(e),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,r){},markers:[]},n=-1;t.default.registerPlugin("markers",function(e){function o(){g.sort(function(e,r){return b.markerTip.time(e)-b.markerTip.time(r)})}function l(e){e.forEach(function(e){e.key=r(),E.el().querySelector(".vjs-progress-holder").appendChild(f(e)),T[e.key]=e,g.push(e)}),o()}function u(e){return b.markerTip.time(e)/E.duration()*100}function f(e){var r=t.default.dom.createEl("div",{className:"vjs-marker "+(e.class||"")},{"data-marker-key":e.key,"data-marker-time":b.markerTip.time(e)});return Object.keys(b.markerStyle).forEach(function(e){r.style[e]=b.markerStyle[e]}),r.style.left=u(e)+"%",r.style.marginLeft=r.offsetWidth/2+"px",r.addEventListener("click",function(r){var t=!1;if("function"==typeof b.onMarkerClick&&(t=!1===b.onMarkerClick(e)),!t){var i=this.getAttribute("data-marker-key");E.currentTime(b.markerTip.time(T[i]))}}),b.markerTip.display&&d(r),r}function c(){g.forEach(function(e){var r=E.el().querySelector(".vjs-marker[data-marker-key='"+e.key+"']"),t=b.markerTip.time(e);r.getAttribute("data-marker-time")!==t&&(r.style.left=u(e)+"%",r.setAttribute("data-marker-time",t))}),o()}function s(e){O&&(S=n,O.style.visibility="hidden"),j=n;var r=[];e.forEach(function(e){var t=g[e];if(t){delete T[t.key],r.push(e);var i=E.el().querySelector(".vjs-marker[data-marker-key='"+t.key+"']");i.parentNode.removeChild(i)}}),r.reverse(),r.forEach(function(e){g.splice(e,1)}),o()}function d(e){e.addEventListener("mouseover",function(){var r=T[e.getAttribute("data-marker-key")];M&&(M.querySelector(".vjs-tip-inner").innerText=b.markerTip.text(r),M.style.left=u(r)+"%",M.style.marginLeft=-parseFloat(M.offsetWidth/2)+parseFloat(e.offsetWidth/4)+"px",M.style.visibility="visible")}),e.addEventListener("mouseout",function(){M&&(M.style.visibility="hidden")})}function m(){M=t.default.dom.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),E.el().querySelector(".vjs-progress-holder").appendChild(M)}function v(){if(b.breakOverlay.display&&!(j<0)){var e=E.currentTime(),r=g[j],t=b.markerTip.time(r);e>=t&&e<=t+b.breakOverlay.displayTime?(S!==j&&(S=j,O&&(O.querySelector(".vjs-break-overlay-text").innerHTML=b.breakOverlay.text(r))),O&&(O.style.visibility="visible")):(S=n,O&&(O.style.visibility="hidden"))}}function y(){O=t.default.dom.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(b.breakOverlay.style).forEach(function(e){O&&(O.style[e]=b.breakOverlay.style[e])}),E.el().appendChild(O),S=n}function k(){p(),v(),e.onTimeUpdateAfterMarkerUpdate&&e.onTimeUpdateAfterMarkerUpdate()}function p(){if(g.length){var r=function(e){return e<g.length-1?b.markerTip.time(g[e+1]):E.duration()},t=E.currentTime(),i=n;if(j!==n){var a=r(j);if(t>=b.markerTip.time(g[j])&&t<a)return;if(j===g.length-1&&t===E.duration())return}if(t<b.markerTip.time(g[0]))i=n;else for(var o=0;o<g.length;o++)if(a=r(o),t>=b.markerTip.time(g[o])&&t<a){i=o;break}i!==j&&(i!==n&&e.onMarkerReached&&e.onMarkerReached(g[i],i),j=i)}}function x(){b.markerTip.display&&m(),E.markers.removeAll(),l(e.markers),b.breakOverlay.display&&y(),k(),E.on("timeupdate",k),E.off("loadedmetadata")}if(!t.default.mergeOptions){var h=function(e){return!!e&&"object"===(void 0===e?"undefined":i(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};t.default.mergeOptions=function e(r,t){var i={};return[r,t].forEach(function(r){r&&Object.keys(r).forEach(function(t){var a=r[t];h(a)?(h(i[t])||(i[t]={}),i[t]=e(i[t],a)):i[t]=a})}),i}}t.default.dom.createEl||(t.default.dom.createEl=function(e,r,i){var a=t.default.Player.prototype.dom.createEl(e,r);return i&&Object.keys(i).forEach(function(e){a.setAttribute(e,i[e])}),a});var b=t.default.mergeOptions(a,e),T={},g=[],j=n,E=this,M=null,O=null,S=n;E.on("loadedmetadata",function(){x()}),E.markers={getMarkers:function(){return g},next:function(){for(var e=E.currentTime(),r=0;r<g.length;r++){var t=b.markerTip.time(g[r]);if(t>e){E.currentTime(t);break}}},prev:function(){for(var e=E.currentTime(),r=g.length-1;r>=0;r--){var t=b.markerTip.time(g[r]);if(t+.5<e)return void E.currentTime(t)}},add:function(e){l(e)},remove:function(e){s(e)},removeAll:function(){for(var e=[],r=0;r<g.length;r++)e.push(r);s(e)},updateTime:function(){c()},reset:function(e){E.markers.removeAll(),l(e)},destroy:function(){E.markers.removeAll(),O&&O.remove(),M&&M.remove(),E.off("timeupdate",v),delete E.markers}}})});